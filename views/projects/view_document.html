{{response.files.append(URL(r=request,c='static/css',f='project.css'))}}
{{extend 'crowdscribe-layout.html'}}

<div class="padded_container form_container no_bottom_padding">

  <ul class="breadcrumb">
    <li><a href="{{=URL('projects','project', args=[project.id])}}">{{=project.name}}</a> <span class="divider">/</span></li>
    <li class="active">Document</li>
  </ul>

  <h1>{{=project.name}}</h1>
  <h3>{{=project.tag}} {{=timestring}}</h3>

  <h4>Document Description</h4>
  <p>{{=document.description}}</p>

  <div id="doc_controls">
    <h4>Transcription Instructions</h4>
    <p>To transcribe a document simply enter your transcription for each field in the corresponding form and press 'Submit Transcription'. At least one field must be filled out to submit.</p>
    <p>To view the document in a larger format press the 'Toggle View' button to switch between portrait and landscape mode.</p>
    <button id="toggle_button" class="btn">Toggle View</button>
  </div>

  {{=form.custom.begin}}

  <div id="doc_display" class="border-box-sizing">
    <!-- Maybe highlight that image can be opened in new tab for zooming etc -->
    <div id="document_viewer" class="landscape">
          <!-- <a href="{{=image}}" class="docGal" title="document"><img src="{{=image}}" alt="document"/></a> -->
          <img src="{{=image}}" alt="document"/>
    </div>

    <div id="transcription_form_holder" class="{{="disabled" if response.message else ""}} landscape">
      <h4>{{=len(data_fields) }} Fields for transcription</h4>

      {{if form and not accepted_transcription_with_fields:}}

          <!-- If there is an overlay, the form should be disabled to prevent TABBING into it -->
          <fieldset {{="disabled" if overlay_message else ""}}>

            <!-- We are aware that the IDs for these form fields are not HTML W3C compliant, as they can contain spaces. However this is a requirement of linking the form to the database -->
            <!-- We felt it was a higher priority to provide screen reader accesibility with labels than break these by altering the name of the field -->

              {{for field in data_fields:}}
                <div class="rounded_bordered_container transcription_field">
                  <!-- Fields are displayed as label, description, then edit. This means users with a screen reader will hear the label for the field, its description, and then 'edit', prompting them to start writing -->
                  <label for ="transcription_{{=field}}">{{=field}}</label>
                  <p><b>Field Description</b> : {{=form.custom.comment[field]}}</p>
                  {{=form.custom.widget[field]}}

                </div>
              {{pass}}

          </fieldset>

      {{elif accepted_transcription_with_fields:}}

        <h3>Accepted Transcription</h3>

        {{for field in accepted_transcription_with_fields:}}
        <h4>{{=field.data_field.name}}</h4>
        <p>

          {{=field.data_field.short_description}}
        </p>

        {{pass}}

      {{pass}}

      {{if overlay_message and not accepted_transcription_with_fields:}}
          <div class="unavailable_overlay">
            <div class="notice">
              {{=overlay_message}}
            </div>
          </div>

      {{pass}}
    </div>

  </div>

  <div id="doc_submit">

    {{if form and not response.message and not accepted_transcription_with_fields:}}
        <input class="btn btn-primary" type="submit" value="Submit Transcription">
    {{elif accepted_transcription_with_fields:}}
      <input class="btn btn-primary" type="submit" value="Transcription Already Accepted" disabled>
    {{elif response.message:}}
      <input class="btn btn-primary" type="submit" value="Cannot Currently Submit Transcription" disabled>
    {{pass}}

    {{=form.custom.end}}

  </div>

</div>

<script>
  $("#toggle_button").click(function(){
    $("#document_viewer")          .toggleClass('portrait').toggleClass('landscape');
    $("#transcription_form_holder").toggleClass('portrait').toggleClass('landscape');
  })

</script>
